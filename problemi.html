<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matematica - Confronti e Frazioni</title>
    <style>
        /* TUTTI GLI STILI RESTANO UGUALI ALLA VERSIONE PRECEDENTE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }
        
        body {
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3px;
            color: white;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .game-container {
            background: linear-gradient(145deg, #2d3047, #1f2235);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            padding: 8px;
            width: 100%;
            max-width: 1000px;
            text-align: center;
            border: 2px solid #3a3f5c;
            position: relative;
            overflow: hidden;
            margin: auto;
            max-height: 98vh;
            overflow-y: auto;
        }
        
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b00, #ffa500, #ff6b00);
            z-index: 1;
        }
        
        .game-header {
            margin-bottom: 8px;
            position: relative;
        }
        
        h1 {
            color: #ffa500;
            font-size: 1.3rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(90deg, #ff6b00, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            line-height: 1.2;
            padding: 0 5px;
        }
        
        /* Container per tipi di domande - AGGIUNTO ORDINAMENTI */
        .tipo-domanda-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 8px 0 10px 0;
            width: 100%;
            flex-wrap: wrap;
        }
        
        .tipo-domanda-btn {
            padding: 8px 16px;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            background: rgba(74, 144, 226, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        
        .tipo-domanda-btn:hover {
            background: rgba(74, 144, 226, 0.4);
            transform: translateY(-1px);
        }
        
        .tipo-domanda-btn.attiva {
            background: #4a90e2;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 12px rgba(74, 144, 226, 0.5);
            border: 2px solid #5aa0f0;
        }
        
        .cruscotto-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            padding: 6px;
            margin: 6px 0;
            border: 2px solid #3a3f5c;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.5),
                        0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            flex-wrap: nowrap;
            overflow: hidden;
        }
        
        .cruscotto-container::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border: 1px solid rgba(255, 165, 0, 0.2);
            border-radius: 5px;
            pointer-events: none;
        }
        
        .indicatore-cruscotto {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
            min-width: 0;
            padding: 0 5px;
        }
        
        .display-container {
            position: relative;
            width: 80px;
            height: 40px;
            margin-bottom: 3px;
            background: linear-gradient(145deg, #0a0e14, #05070a);
            border-radius: 5px;
            border: 2px solid #1a3b5d;
            box-shadow: 
                inset 0 0 8px rgba(0, 20, 40, 0.8),
                0 3px 4px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(0, 100, 200, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .display-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px,
                transparent 3px
            );
            pointer-events: none;
            z-index: 1;
        }
        
        .display-7segmenti {
            font-family: 'Courier New', monospace;
            font-size: 1.4rem;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 
                0 0 6px rgba(255, 0, 0, 0.8),
                0 0 10px rgba(255, 0, 0, 0.4);
            letter-spacing: 0.6px;
            position: relative;
            z-index: 2;
            transform: skew(-1deg);
            font-variant-numeric: tabular-nums;
        }
        
        .display-7segmenti.giallo {
            color: #ffcc00;
            text-shadow: 
                0 0 6px rgba(255, 204, 0, 0.8),
                0 0 10px rgba(255, 204, 0, 0.4);
        }
        
        .display-7segmenti.verde {
            color: #00ff00;
            text-shadow: 
                0 0 6px rgba(0, 255, 0, 0.8),
                0 0 10px rgba(0, 255, 0, 0.4);
        }
        
        .display-7segmenti.tempo {
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }
        
        .display-title {
            margin-top: 3px;
            font-size: 0.75rem;
            color: #ffcc00;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(255, 204, 0, 0.5);
            letter-spacing: 0.2px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid rgba(255, 204, 0, 0.3);
            font-family: 'Courier New', monospace;
            white-space: nowrap;
        }
        
        .istruzioni-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 0 5px;
        }
        
        .istruzioni-btn {
            padding: 7px 14px;
            background: linear-gradient(145deg, #ffa500, #ff8c00);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            font-size: 0.85rem;
            line-height: 1.2;
            width: 100%;
            max-width: 110px;
        }
        
        .istruzioni-btn:hover {
            background: linear-gradient(145deg, #ff8c00, #e67e00);
            transform: translateY(-2px);
        }
        
        .vite-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
            width: 100%;
        }
        
        .vita {
            width: 22px;
            height: 22px;
            background: #ff4757;
            clip-path: polygon(50% 0%, 100% 35%, 82% 100%, 18% 100%, 0% 35%);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
            transition: all 0.3s ease;
        }
        
        .vita.persa {
            background: #3a3f5c;
            transform: scale(0.8);
        }
        
        .sezione-gioco {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            position: relative;
        }
        
        .area-domanda {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(30, 33, 57, 0.8);
            border: 2px solid #4a90e2;
            border-radius: 6px;
            padding: 15px;
            margin: 6px 0;
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 800px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .testo-domanda {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffcc00;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.4;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            padding: 0 10px;
        }
        
        .opzioni-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }
        
        .opzione-btn {
            padding: 12px 5px;
            background: linear-gradient(145deg, #3a3f5c, #2d3047);
            border: 2px solid #4a90e2;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .opzione-btn:hover {
            background: linear-gradient(145deg, #4a4f6c, #3d4057);
            transform: translateY(-3px);
            border-color: #5aa0f0;
        }
        
        .opzione-btn.selezionata {
            background: linear-gradient(145deg, #28a745, #1e7e34);
            border-color: #32cd32;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
        }
        
        .opzione-btn.errata {
            background: linear-gradient(145deg, #dc3545, #c82333);
            border-color: #ff4757;
        }
        
        /* Container per risposta aperta */
        .risposta-aperta-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .risposta-input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .casella-risposta {
            width: 50px;
            height: 60px;
            margin: 0 5px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #4a90e2;
            border-radius: 8px;
            color: white;
            outline: none;
        }
        
        .casella-risposta:focus {
            border-color: #ffa500;
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .casella-risposta.corretta {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.2);
        }
        
        .casella-risposta.errata {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.2);
        }
        
        .messaggio-verifica {
            background: rgba(255, 193, 7, 0.2);
            border: 2px dashed #ffc107;
            border-radius: 6px;
            padding: 8px 10px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            color: white;
            width: 90%;
            max-width: 450px;
            margin: 6px auto;
            text-align: center;
        }
        
        .messaggio-verifica.mostra {
            opacity: 1;
            transform: translateY(0);
        }
        
        .messaggio-corretto {
            background: rgba(40, 167, 69, 0.3);
            border-color: #28a745;
            color: #90ee90;
        }
        
        .messaggio-errato {
            background: rgba(220, 53, 69, 0.3);
            border-color: #dc3545;
            color: #ff6b6b;
        }
        
        .messaggio-info {
            background: rgba(255, 193, 7, 0.3);
            border-color: #ffc107;
            color: #ffd166;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .messaggio-info:hover {
            background: rgba(255, 193, 7, 0.4);
        }
        
        .messaggio-game-over {
            background: rgba(108, 117, 125, 0.3);
            border-color: #495057;
            color: white;
            font-size: 0.8rem;
            padding: 10px;
        }
        
        .messaggio-wow {
            background: linear-gradient(145deg, #ff0080, #ff00ff);
            border: 2px solid #ff00ff;
            color: #ffffff;
            animation: rainbow 2s infinite;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }
        
        .messaggio-ahi {
            background: linear-gradient(145deg, #ff0000, #ff4500);
            border: 2px solid #ff0000;
            color: #ffffff;
            animation: shake 0.5s ease-in-out;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }
        
        @keyframes rainbow {
            0%, 100% { 
                background: linear-gradient(145deg, #ff0080, #ff00ff);
                box-shadow: 0 0 12px rgba(255, 0, 255, 0.8);
            }
            25% { 
                background: linear-gradient(145deg, #00ffff, #0080ff);
                box-shadow: 0 0 12px rgba(0, 255, 255, 0.8);
            }
            50% { 
                background: linear-gradient(145deg, #00ff80, #00ff00);
                box-shadow: 0 0 12px rgba(0, 255, 0, 0.8);
            }
            75% { 
                background: linear-gradient(145deg, #ffff00, #ff8000);
                box-shadow: 0 0 12px rgba(255, 255, 0, 0.8);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .controlli {
            display: none;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
            flex-wrap: wrap;
            animation: fadeIn 0.5s ease 0.3s both;
        }
        
        .bottone {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: linear-gradient(145deg, #4a90e2, #3a7bd5);
            color: white;
            transition: all 0.2s;
            min-width: 90px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            font-size: 0.85rem;
            line-height: 1.2;
            flex: 1;
            max-width: 140px;
        }
        
        .bottone:hover {
            background: linear-gradient(145deg, #3a7bd5, #2a6bc5);
            transform: translateY(-2px);
            box-shadow: 0 5px 7px rgba(0, 0, 0, 0.4);
        }
        
        .bottone-verifica {
            background: linear-gradient(145deg, #28a745, #1e7e34);
        }
        
        .bottone-verifica:hover {
            background: linear-gradient(145deg, #1e7e34, #156d2b);
        }
        
        .bottone-aiuto {
            background: linear-gradient(145deg, #ffa500, #ff8c00);
        }
        
        .bottone-aiuto:hover {
            background: linear-gradient(145deg, #ff8c00, #e67e00);
        }
        
        .bottone-nuova {
            background: linear-gradient(145deg, #9370db, #7b5fcf);
        }
        
        .bottone-nuova:hover {
            background: linear-gradient(145deg, #7b5fcf, #6a4fcb);
        }
        
        .tastiera-container {
            display: none;
            background: rgba(30, 33, 57, 0.8);
            border-radius: 6px;
            padding: 8px;
            border: 2px solid #4a90e2;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.4);
            margin-top: 8px;
            animation: fadeIn 0.5s ease 0.6s both;
        }
        
        .tastiera-numerica {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .tasto-numero {
            width: 40px;
            height: 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            background: linear-gradient(145deg, #3a3f5c, #2d3047);
            cursor: pointer;
            color: #ffffff;
            transition: all 0.2s;
            flex: 0 0 auto;
        }
        
        .tasto-numero:hover {
            background: linear-gradient(145deg, #4a4f6c, #3d4057);
            transform: translateY(-2px);
        }
        
        .tasto-cancella {
            background: linear-gradient(145deg, #ff4757, #ff3742);
            color: white;
            border-color: #dc3545;
            font-size: 0.9rem;
            width: 60px;
        }
        
        .tasto-cancella:hover {
            background: linear-gradient(145deg, #ff3742, #ff2732);
        }
        
        .tasto-vf {
            width: 120px;
            height: 50px;
            font-size: 1.2rem;
            margin: 5px;
        }
        
        .risposte-consecutive, .aiuti-utilizzati {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
            font-size: 0.65rem;
            color: #a0a0c0;
            font-weight: bold;
        }
        
        .cuore-consecutivo {
            color: #ff4757;
            font-size: 0.8rem;
        }
        
        .icona-aiuto {
            color: #ffa500;
            font-size: 0.8rem;
        }
        
        .messaggio-avvio {
            background: linear-gradient(145deg, #4a90e2, #3a7bd5);
            border: 3px solid #ffa500;
            border-radius: 10px;
            padding: 15px;
            margin: 10px auto;
            max-width: 450px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            animation: pulse-glow 2s infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4),
                            0 0 0px rgba(255, 165, 0, 0.5);
            }
            50% { 
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4),
                            0 0 20px rgba(255, 165, 0, 0.8);
            }
        }
        
        .messaggio-avvio:hover {
            transform: scale(1.03);
            background: linear-gradient(145deg, #3a7bd5, #2a6bc5);
        }
        
        .messaggio-avvio h2 {
            color: #ffcc00;
            font-size: 1.3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .messaggio-avvio p {
            color: white;
            margin-bottom: 6px;
            font-size: 0.9rem;
            line-height: 1.3;
            text-align: center;
        }
        
        .messaggio-avvio .istruzione-principale {
            font-size: 1rem;
            font-weight: bold;
            color: #ffcc00;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        
        .messaggio-avvio .istruzione-gioco {
            font-size: 0.9rem;
            color: #ffd166;
            background: rgba(255, 193, 7, 0.2);
            border: 2px dashed #ffc107;
            border-radius: 6px;
            padding: 8px 12px;
            margin-top: 8px;
            width: 90%;
            max-width: 350px;
        }
        
        .icona-play {
            font-size: 2rem;
            margin-bottom: 10px;
            animation: bounce 1.5s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #2d3047, #1f2235);
            border-radius: 6px;
            padding: 10px;
            width: 95%;
            max-width: 450px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            border: 2px solid #4a90e2;
            position: relative;
            color: white;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 5px;
        }
        
        .modal-title {
            color: #ffa500;
            font-size: 0.9rem;
        }
        
        .close-modal {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .modal-section {
            margin-bottom: 8px;
            text-align: left;
        }
        
        .modal-section h3 {
            color: #4a90e2;
            margin-bottom: 4px;
            font-size: 0.8rem;
            border-left: 3px solid #ffa500;
            padding-left: 4px;
        }
        
        .modal-section p {
            margin-bottom: 4px;
            line-height: 1.2;
            font-size: 0.7rem;
            color: #d0d0e0;
        }
        
        .modal-list {
            list-style-type: decimal;
            padding-left: 12px;
            margin: 5px 0;
            color: #d0d0e0;
        }
        
        .modal-list li {
            margin-bottom: 4px;
            line-height: 1.2;
            font-size: 0.7rem;
        }
        
        .punteggio-info {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .punteggio-item {
            background: rgba(74, 144, 226, 0.2);
            padding: 4px;
            border-radius: 4px;
            border: 2px solid #4a90e2;
            flex: 1;
            min-width: 80px;
        }
        
        .punteggio-item .value {
            font-weight: bold;
            color: #28a745;
            font-size: 0.75rem;
        }
        
        /* MEDIA QUERIES PER MOBILE */
        @media (max-width: 768px) {
            body {
                padding: 2px;
                align-items: flex-start;
            }
            
            .game-container {
                padding: 6px;
                margin: 2px auto;
                border-radius: 10px;
                max-height: 96vh;
            }
            
            h1 {
                font-size: 1.2rem;
                margin-bottom: 6px;
            }
            
            .tipo-domanda-container {
                margin: 6px 0 8px 0;
                gap: 8px;
            }
            
            .tipo-domanda-btn {
                padding: 7px 14px;
                font-size: 0.8rem;
                min-width: 85px;
            }
            
            .cruscotto-container {
                padding: 5px;
                margin: 4px 0;
            }
            
            .display-container {
                width: 75px;
                height: 36px;
            }
            
            .display-7segmenti {
                font-size: 1.3rem;
            }
            
            .display-7segmenti.tempo {
                font-size: 0.9rem;
            }
            
            .display-title {
                font-size: 0.7rem;
                padding: 2px 5px;
            }
            
            .istruzioni-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
                max-width: 100px;
            }
            
            .area-domanda {
                padding: 12px;
                margin: 4px 0;
            }
            
            .testo-domanda {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
            
            .opzioni-container {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .opzione-btn {
                padding: 10px;
                font-size: 1rem;
            }
            
            .vite-container {
                margin: 6px 0;
            }
            
            .vita {
                width: 20px;
                height: 20px;
            }
            
            .controlli {
                gap: 6px;
                margin: 6px 0;
            }
            
            .bottone {
                padding: 7px 10px;
                min-width: 80px;
                font-size: 0.8rem;
                max-width: 120px;
            }
            
            .messaggio-avvio {
                padding: 12px;
                margin: 8px auto;
            }
            
            .messaggio-avvio h2 {
                font-size: 1.2rem;
            }
            
            .messaggio-avvio p {
                font-size: 0.85rem;
            }
            
            .tastiera-container {
                padding: 6px;
            }
            
            .tasto-numero {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
            
            .tasto-cancella {
                width: 70px;
                font-size: 0.9rem;
                height: 45px;
            }
            
            .tasto-vf {
                width: 100px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .casella-risposta {
                width: 45px;
                height: 55px;
                font-size: 1.8rem;
            }
            
            .messaggio-verifica {
                padding: 6px 8px;
                min-height: 35px;
                font-size: 0.75rem;
                margin: 4px auto;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 5px;
                max-height: 94vh;
            }
            
            h1 {
                font-size: 1.1rem;
                margin-bottom: 4px;
            }
            
            .tipo-domanda-container {
                gap: 6px;
                margin: 4px 0 6px 0;
            }
            
            .tipo-domanda-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
                min-width: 75px;
            }
            
            .cruscotto-container {
                padding: 4px;
            }
            
            .display-container {
                width: 70px;
                height: 34px;
            }
            
            .display-7segmenti {
                font-size: 1.2rem;
            }
            
            .display-7segmenti.tempo {
                font-size: 0.85rem;
            }
            
            .display-title {
                font-size: 0.65rem;
                padding: 2px 4px;
            }
            
            .istruzioni-btn {
                padding: 5px 10px;
                font-size: 0.75rem;
                max-width: 90px;
            }
            
            .testo-domanda {
                font-size: 1.1rem;
            }
            
            .vita {
                width: 18px;
                height: 18px;
            }
            
            .controlli {
                gap: 4px;
            }
            
            .bottone {
                padding: 6px 8px;
                min-width: 70px;
                font-size: 0.75rem;
                max-width: 100px;
            }
            
            .messaggio-avvio {
                padding: 10px;
            }
            
            .messaggio-avvio h2 {
                font-size: 1.1rem;
            }
            
            .messaggio-avvio p {
                font-size: 0.8rem;
            }
            
            .icona-play {
                font-size: 1.8rem;
            }
            
            .tasto-numero {
                width: 48px;
                height: 48px;
                font-size: 1.3rem;
            }
            
            .tasto-cancella {
                width: 75px;
                height: 48px;
            }
            
            .tasto-vf {
                width: 90px;
                height: 40px;
                font-size: 1rem;
            }
            
            .casella-risposta {
                width: 40px;
                height: 50px;
                font-size: 1.6rem;
            }
            
            .messaggio-verifica {
                font-size: 0.7rem;
                padding: 5px 6px;
                min-height: 30px;
            }
            
            .modal-content {
                padding: 8px;
            }
        }
        
        @media (max-width: 360px) {
            .tipo-domanda-container {
                flex-direction: row;
                gap: 4px;
                align-items: center;
                justify-content: center;
            }
            
            .tipo-domanda-btn {
                width: auto;
                max-width: 100px;
                padding: 5px 8px;
                font-size: 0.7rem;
            }
            
            .cruscotto-container {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }
            
            .indicatore-cruscotto, .istruzioni-container {
                flex: 0 0 calc(50% - 10px);
                margin-bottom: 5px;
            }
            
            .istruzioni-container {
                order: 3;
                flex: 0 0 100%;
            }
            
            .controlli {
                flex-direction: column;
                align-items: center;
            }
            
            .bottone {
                width: 100%;
                max-width: 200px;
            }
            
            .opzioni-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ORDINAMENTI NUMERICI - SCUOLA PRIMARIA</h1>
            
            <!-- Container per tipi di domande - MODIFICATO TITOLO -->
            <div class="tipo-domanda-container">
                <button class="tipo-domanda-btn attiva" id="tipo-ordinamenti">
                    Ordinamenti
                </button>
                <button class="tipo-domanda-btn" id="tipo-problemi">
                    Problemi
                </button>
                <button class="tipo-domanda-btn" id="tipo-confronti">
                    Confronti
                </button>
                <button class="tipo-domanda-btn" id="tipo-frazioni">
                    Frazioni
                </button>
            </div>
            
            <div class="cruscotto-container">
                <div class="indicatore-cruscotto">
                    <div class="display-container">
                        <div class="display-7segmenti giallo" id="punteggio-display">0</div>
                    </div>
                    <div class="display-title">PUNTEGGIO</div>
                </div>
                
                <div class="istruzioni-container">
                    <button class="istruzioni-btn" id="istruzioni-btn" title="Istruzioni del gioco">
                        üìö Istruzioni
                    </button>
                </div>
                
                <div class="indicatore-cruscotto">
                    <div class="display-container">
                        <div class="display-7segmenti verde tempo" id="tempo-display">10:00</div>
                    </div>
                    <div class="display-title">TEMPO</div>
                </div>
            </div>
            
            <div class="vite-container" id="vite-container"></div>
            
            <div class="risposte-consecutive" id="risposte-consecutive">
                <span>Risposte consecutive corrette:</span>
                <span id="contatore-consecutive">0</span>
                <span class="cuore-consecutivo">‚ù§Ô∏è</span>
            </div>
            
            <div class="aiuti-utilizzati" id="aiuti-utilizzati">
                <span>Aiuti utilizzati in questa domanda:</span>
                <span id="contatore-aiuti">0</span>
                <span class="icona-aiuto">üß†</span>
                <span>(costo: -2 punti ciascuno)</span>
            </div>
        </div>
        
        <div class="sezione-gioco">
            <div class="messaggio-avvio" id="messaggio-avvio">
                <div class="icona-play">üéÆ</div>
                <h2>Pronti per ordinare numeri?</h2>
                <p>Metti in ordine numeri interi, decimali e frazioni!</p>
                <p>Dall'ordine crescente a quello decrescente.</p>
                <div class="istruzione-gioco">
                    Clicca su una opzione per sceglierla, oppure scrivi la sequenza corretta.
                </div>
                <p class="istruzione-principale">Clicca qui per iniziare a giocare!</p>
            </div>
            
            <div class="area-domanda" id="area-domanda">
                <!-- Qui verr√† inserita la domanda dinamicamente -->
            </div>
            
            <div class="messaggio-verifica" id="messaggio-verifica"></div>
        </div>
        
        <div class="controlli" id="controlli-gioco">
            <button class="bottone bottone-aiuto" id="bottone-aiuto">
                üß† Aiuto (-2)
            </button>
            <button class="bottone bottone-verifica" id="bottone-verifica">
                ‚úì Verifica
            </button>
            <button class="bottone bottone-nuova" id="bottone-nuova">
                üîÑ Nuova
            </button>
        </div>
        
        <div class="tastiera-container" id="tastiera-container">
            <!-- La tastiera verr√† generata dinamicamente in base al tipo di domanda -->
        </div>
    </div>

    <!-- MODALE ISTRUZIONI -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    üìö Istruzioni del Gioco - Ordinamenti Numerici
                </div>
                <button class="close-modal" id="close-modal">‚úï</button>
            </div>
            
            <div class="modal-section">
                <h3>üéØ Come Giocare</h3>
                <p>Metti in ordine numeri interi, decimali e frazioni:</p>
                <ol class="modal-list">
                    <li>Scegli il tipo di domanda (Ordinamenti, Problemi, Confronti, Frazioni)</li>
                    <li>Leggi attentamente la domanda</li>
                    <li>Per domande a scelta multipla: clicca sull'ordine corretto</li>
                    <li>Per vero/falso: clicca su VERO o FALSO</li>
                    <li>Per risposte aperte: scrivi la sequenza corretta separata da virgole</li>
                    <li>Premi "Verifica" per controllare la risposta</li>
                </ol>
            </div>
            
            <div class="modal-section">
                <h3>üî¢ Tipi di Domande</h3>
                <p><strong>Ordinamenti:</strong> Metti in ordine numeri interi, decimali e frazioni</p>
                <p><strong>Problemi:</strong> Problemi con frazioni (senza operazioni)</p>
                <p><strong>Confronti:</strong> Confronta numeri decimali, frazioni e interi</p>
                <p><strong>Frazioni:</strong> Concetti base sulle frazioni</p>
                <p><strong>Vero/Falso:</strong> Affermazioni da valutare come vere o false</p>
                <p><strong>Scelta Multipla:</strong> 4 opzioni, una sola corretta</p>
            </div>
            
            <div class="modal-section">
                <h3>üèÜ Sistema dei Punteggi e Vite</h3>
                <div class="punteggio-info">
                    <div class="punteggio-item">
                        <div>Risposta corretta:</div>
                        <div class="value">+2 punti</div>
                    </div>
                    <div class="punteggio-item">
                        <div>Aiuto utilizzato:</div>
                        <div class="value">-2 punti ciascuno</div>
                    </div>
                    <div class="punteggio-item">
                        <div>Errore:</div>
                        <div class="value">-1 vita</div>
                    </div>
                    <div class="punteggio-item">
                        <div>5 risposte corrette consecutive:</div>
                        <div class="value">+1 vita</div>
                    </div>
                </div>
                <p><strong>‚ö†Ô∏è Attenzione:</strong> Se usi troppi aiuti, potresti finire con 0 punti per quella domanda!</p>
                <p><strong>‚ú® Bonus Vita:</strong> Ogni 5 risposte consecutive corrette, recuperi una vita (massimo 3 vite).</p>
            </div>
            
            <div class="modal-section">
                <h3>‚è±Ô∏è Tempo</h3>
                <p>Hai 10 minuti per rispondere a quante pi√π domande possibili!</p>
                <p>Il timer diventa rosso quando mancano meno di 60 secondi.</p>
            </div>
        </div>
    </div>

    <script>
        // VARIABILI DEL GIOCO
        let punteggio = 0;
        let vite = 3;
        let tipoGioco = 'ordinamenti';
        let verificaEseguita = false;
        let gameOver = false;
        let haSbagliatoQuestaDomanda = false;
        
        let operazioniCorretteConsecutive = 0;
        let aiutiUtilizzatiDomandaCorrente = 0;
        let rispostaCorrente = null;
        let opzioneSelezionata = null;
        let rispostaAperta = "";
        
        let tempoRimanente = 600;
        let timerInterval;
        let timerAttivo = false;
        const TEMPO_TOTALE = 600;
        
        let timeoutBenvenuto = null;
        let giocoIniziato = false;
        
        // ARRAY DI DOMANDE - MOLTE PI√ô DOMANDE DI ORDINAMENTO
        const domande = {
            ordinamenti: [
                // ORDINAMENTI CRESCENTI
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 12, 5, 18, 9",
                    opzioni: ["5, 9, 12, 18", "18, 12, 9, 5", "5, 12, 9, 18", "9, 5, 12, 18"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 0.3, 0.15, 0.25, 0.4",
                    opzioni: ["0.15, 0.25, 0.3, 0.4", "0.4, 0.3, 0.25, 0.15", "0.25, 0.15, 0.3, 0.4", "0.3, 0.4, 0.15, 0.25"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 1/2, 1/4, 3/4, 1/8",
                    opzioni: ["1/8, 1/4, 1/2, 3/4", "3/4, 1/2, 1/4, 1/8", "1/4, 1/2, 1/8, 3/4", "1/2, 1/4, 3/4, 1/8"],
                    risposta: 0,
                    difficolta: 2
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 2.5, 1.8, 3.1, 2.0",
                    opzioni: ["1.8, 2.0, 2.5, 3.1", "3.1, 2.5, 2.0, 1.8", "2.0, 1.8, 2.5, 3.1", "2.5, 3.1, 1.8, 2.0"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 7, 12, 4, 9, 15",
                    opzioni: ["4, 7, 9, 12, 15", "15, 12, 9, 7, 4", "7, 4, 9, 12, 15", "4, 9, 7, 12, 15"],
                    risposta: 0,
                    difficolta: 1
                },
                
                // ORDINAMENTI DECRESCENTI
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 25, 18, 32, 14",
                    opzioni: ["32, 25, 18, 14", "14, 18, 25, 32", "25, 32, 18, 14", "18, 25, 14, 32"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 0.9, 0.75, 0.85, 0.6",
                    opzioni: ["0.9, 0.85, 0.75, 0.6", "0.6, 0.75, 0.85, 0.9", "0.85, 0.9, 0.75, 0.6", "0.75, 0.6, 0.9, 0.85"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 3/4, 1/2, 2/3, 5/8",
                    opzioni: ["3/4, 2/3, 5/8, 1/2", "1/2, 5/8, 2/3, 3/4", "2/3, 3/4, 1/2, 5/8", "5/8, 2/3, 3/4, 1/2"],
                    risposta: 0,
                    difficolta: 2
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 4.2, 3.8, 4.5, 3.5",
                    opzioni: ["4.5, 4.2, 3.8, 3.5", "3.5, 3.8, 4.2, 4.5", "4.2, 4.5, 3.8, 3.5", "3.8, 3.5, 4.2, 4.5"],
                    risposta: 0,
                    difficolta: 1
                },
                
                // ORDINAMENTI MISTI (interi, decimali, frazioni)
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 0.5, 1/2, 0.4, 3/8",
                    opzioni: ["3/8, 0.4, 0.5, 1/2", "0.4, 3/8, 0.5, 1/2", "1/2, 0.5, 0.4, 3/8", "0.5, 1/2, 0.4, 3/8"],
                    risposta: 1,
                    difficolta: 2
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 2, 1.5, 1.75, 2.25",
                    opzioni: ["1.5, 1.75, 2, 2.25", "2.25, 2, 1.75, 1.5", "2, 1.5, 1.75, 2.25", "1.75, 1.5, 2, 2.25"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 1/3, 0.4, 0.3, 2/5",
                    opzioni: ["0.4, 2/5, 1/3, 0.3", "2/5, 0.4, 1/3, 0.3", "0.3, 1/3, 2/5, 0.4", "1/3, 0.3, 0.4, 2/5"],
                    risposta: 1,
                    difficolta: 3
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 0.25, 1/3, 0.3, 2/7",
                    opzioni: ["0.25, 2/7, 0.3, 1/3", "2/7, 0.25, 0.3, 1/3", "1/3, 0.3, 0.25, 2/7", "0.3, 1/3, 0.25, 2/7"],
                    risposta: 1,
                    difficolta: 3
                },
                
                // ORDINAMENTI CON PI√ô NUMERI
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: 0.1, 1/10, 0.15, 1/8, 0.2",
                    opzioni: ["0.1, 1/10, 0.15, 1/8, 0.2", "0.2, 1/8, 0.15, 1/10, 0.1", "1/10, 0.1, 1/8, 0.15, 0.2", "1/8, 0.15, 0.1, 1/10, 0.2"],
                    risposta: 0,
                    difficolta: 2
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: 1.2, 1 1/4, 1.3, 1.15, 1 1/5",
                    opzioni: ["1.3, 1.2, 1 1/4, 1 1/5, 1.15", "1.15, 1 1/5, 1 1/4, 1.2, 1.3", "1 1/4, 1.3, 1.2, 1 1/5, 1.15", "1.2, 1.3, 1 1/4, 1.15, 1 1/5"],
                    risposta: 0,
                    difficolta: 3
                },
                
                // VERO/FALSO SU ORDINAMENTI
                {
                    tipo: "vero_falso",
                    domanda: "I numeri 0.2, 1/5, 0.25, 3/10 sono in ordine crescente.",
                    risposta: true,
                    difficolta: 2
                },
                {
                    tipo: "vero_falso",
                    domanda: "I numeri 3/4, 0.8, 0.7, 2/3 sono in ordine decrescente.",
                    risposta: true,
                    difficolta: 2
                },
                {
                    tipo: "vero_falso",
                    domanda: "1/2 √® maggiore di 0.6.",
                    risposta: false,
                    difficolta: 1
                },
                {
                    tipo: "vero_falso",
                    domanda: "0.75 √® uguale a 3/4.",
                    risposta: true,
                    difficolta: 1
                },
                
                // RISPOSTE APERTE
                {
                    tipo: "risposta_aperta",
                    domanda: "Scrivi in ordine CRESCENTE: 0.9, 3/4, 1.2, 1/3 (separati da virgola)",
                    risposta: "1/3, 3/4, 0.9, 1.2",
                    difficolta: 2
                },
                {
                    tipo: "risposta_aperta",
                    domanda: "Scrivi in ordine DECRESCENTE: 2.5, 2 1/4, 2.3, 2.75 (separati da virgola)",
                    risposta: "2.75, 2.5, 2.3, 2 1/4",
                    difficolta: 2
                },
                {
                    tipo: "risposta_aperta",
                    domanda: "Scrivi in ordine CRESCENTE: 0.15, 1/5, 0.2, 3/20 (separati da virgola)",
                    risposta: "0.15, 3/20, 1/5, 0.2",
                    difficolta: 3
                },
                {
                    tipo: "risposta_aperta",
                    domanda: "Scrivi in ordine DECRESCENTE: 0.4, 3/8, 0.45, 5/12 (separati da virgola)",
                    risposta: "0.45, 0.4, 5/12, 3/8",
                    difficolta: 3
                },
                {
                    tipo: "risposta_aperta",
                    domanda: "Scrivi in ordine CRESCENTE: 0.6, 3/5, 0.58, 11/20 (separati da virgola)",
                    risposta: "0.58, 11/20, 3/5, 0.6",
                    difficolta: 3
                },
                
                // ORDINAMENTI CON NUMERI NEGATIVI (per difficolt√† maggiore)
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine CRESCENTE: -2, 0, -1, 1, -3",
                    opzioni: ["-3, -2, -1, 0, 1", "1, 0, -1, -2, -3", "-2, -3, -1, 0, 1", "0, -1, -2, -3, 1"],
                    risposta: 0,
                    difficolta: 3
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Metti in ordine DECRESCENTE: -0.5, 0, 0.5, -1, 1",
                    opzioni: ["1, 0.5, 0, -0.5, -1", "-1, -0.5, 0, 0.5, 1", "0.5, 0, -0.5, 1, -1", "0, 0.5, 1, -0.5, -1"],
                    risposta: 0,
                    difficolta: 3
                }
            ],
            
            problemi: [
                {
                    tipo: "scelta_multipla",
                    domanda: "Luca ha percorso una pista di 15 km e si √® fermato dopo aver percorso i 2/3 della pista. Quanti km ha percorso?",
                    opzioni: ["5 km", "10 km", "12 km", "13 km"],
                    risposta: 1,
                    difficolta: 2
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Una torta √® stata divisa in 8 fette uguali. Anna ne mangia 2 fette. Che frazione della torta ha mangiato?",
                    opzioni: ["1/8", "1/4", "1/3", "2/8"],
                    risposta: 1,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Marco ha 24 caramelle. Se ne mangia i 3/8, quante caramelle ha mangiato?",
                    opzioni: ["6 caramelle", "8 caramelle", "9 caramelle", "12 caramelle"],
                    risposta: 2,
                    difficolta: 2
                }
            ],
            
            confronti: [
                {
                    tipo: "scelta_multipla",
                    domanda: "Quale numero √® maggiore: 0.7 o 7/10?",
                    opzioni: ["0.7", "7/10", "Sono uguali"],
                    risposta: 2,
                    difficolta: 1
                },
                {
                    tipo: "vero_falso",
                    domanda: "0.25 √® uguale a 1/4.",
                    risposta: true,
                    difficolta: 1
                },
                {
                    tipo: "scelta_multipla",
                    domanda: "Quale numero √® minore: 3/4 o 0.8?",
                    opzioni: ["3/4", "0.8", "Sono uguali"],
                    risposta: 0,
                    difficolta: 1
                }
            ],
            
            frazioni: [
                {
                    tipo: "scelta_multipla",
                    domanda: "Quale frazione rappresenta la parte colorata se ho diviso un cerchio in 8 parti e ne ho colorate 3?",
                    opzioni: ["3/8", "5/8", "1/3", "3/5"],
                    risposta: 0,
                    difficolta: 1
                },
                {
                    tipo: "vero_falso",
                    domanda: "La frazione 4/6 √® equivalente a 2/3.",
                    risposta: true,
                    difficolta: 1
                }
            ]
        };
        
        let domandaCorrente = null;
        let domandeDisponibili = [...domande.ordinamenti];
        
        // AUDIO CONTEXT PER SUONI
        let audioContext;
        let audioInizializzato = false;
        
        // SUONI PRECARICATI
        let wowSound = null;
        let ahiSound = null;
        let successSound = null;
        let clickSound = null;
        let startSound = null;

        // INIZIALIZZAZIONE AUDIO
        function inizializzaAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                creaSuoni();
                audioInizializzato = true;
            } catch (e) {
                console.log("Audio non supportato:", e);
                audioInizializzato = false;
            }
        }
        
        function creaSuoni() {
            // SUONO WOW
            try {
                const durata = 1.5;
                const buffer = audioContext.createBuffer(1, audioContext.sampleRate * durata, audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < buffer.length; i++) {
                    const t = i / audioContext.sampleRate;
                    
                    let freq1 = 200 + (t * 600);
                    if (freq1 > 800) freq1 = 800;
                    
                    let freq2 = freq1 * 1.5;
                    let freq3 = freq1 * 2;
                    
                    let envelope = Math.sin(Math.PI * t/durata) * 0.7;
                    envelope *= (1 + 0.3 * Math.sin(2 * Math.PI * 2 * t));
                    
                    output[i] = envelope * (
                        Math.sin(2 * Math.PI * freq1 * t) * 0.5 +
                        Math.sin(2 * Math.PI * freq2 * t) * 0.3 +
                        Math.sin(2 * Math.PI * freq3 * t) * 0.2
                    );
                    
                    output[i] *= (1 + 0.1 * Math.sin(2 * Math.PI * 3 * t));
                }
                
                wowSound = buffer;
            } catch (e) {
                console.log("Errore creazione suono wow:", e);
            }
            
            // SUONO AHI
            try {
                const durata = 0.8;
                const buffer = audioContext.createBuffer(1, audioContext.sampleRate * durata, audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < buffer.length; i++) {
                    const t = i / audioContext.sampleRate;
                    
                    let freq = 800 * Math.exp(-t * 3);
                    if (freq < 150) freq = 150;
                    
                    let envelope = Math.exp(-t * 4) * 0.8;
                    
                    const phase = 2 * Math.PI * freq * t;
                    output[i] = envelope * (2 * (phase % (2 * Math.PI)) / (2 * Math.PI) - 1) * 0.5;
                    
                    if (t < 0.1) {
                        output[i] += (Math.random() * 2 - 1) * 0.1 * (1 - t/0.1);
                    }
                }
                
                ahiSound = buffer;
            } catch (e) {
                console.log("Errore creazione suono ahi:", e);
            }
            
            // SUONO DI SUCCESSO
            try {
                const durata = 1.0;
                const buffer = audioContext.createBuffer(1, audioContext.sampleRate * durata, audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < buffer.length; i++) {
                    const t = i / audioContext.sampleRate;
                    
                    let freq = 300;
                    if (t < 0.25) freq = 300;
                    else if (t < 0.5) freq = 400;
                    else if (t < 0.75) freq = 500;
                    else freq = 600;
                    
                    let envelope = Math.sin(Math.PI * t/durata) * 0.6;
                    
                    output[i] = envelope * Math.sin(2 * Math.PI * freq * t);
                    
                    output[i] += 0.3 * envelope * Math.sin(2 * Math.PI * freq * 2 * t);
                }
                
                successSound = buffer;
            } catch (e) {
                console.log("Errore creazione suono successo:", e);
            }
            
            // SUONO DI CLICK
            try {
                const durata = 0.1;
                const buffer = audioContext.createBuffer(1, audioContext.sampleRate * durata, audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < buffer.length; i++) {
                    const t = i / audioContext.sampleRate;
                    
                    let freq = 1000 * Math.exp(-t * 50);
                    let envelope = Math.exp(-t * 100) * 0.3;
                    
                    output[i] = envelope * Math.sin(2 * Math.PI * freq * t);
                }
                
                clickSound = buffer;
            } catch (e) {
                console.log("Errore creazione suono click:", e);
            }
            
            // SUONO DI INIZIO GIOCO
            try {
                const durata = 1.2;
                const buffer = audioContext.createBuffer(1, audioContext.sampleRate * durata, audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < buffer.length; i++) {
                    const t = i / audioContext.sampleRate;
                    
                    let freq = 400 + Math.sin(2 * Math.PI * 2 * t) * 100;
                    let envelope = Math.sin(Math.PI * t/durata) * 0.7;
                    
                    output[i] = envelope * (
                        Math.sin(2 * Math.PI * freq * t) * 0.6 +
                        Math.sin(2 * Math.PI * freq * 1.5 * t) * 0.3 +
                        Math.sin(2 * Math.PI * freq * 2 * t) * 0.1
                    );
                    
                    if (t < 0.5) {
                        output[i] += 0.2 * Math.sin(2 * Math.PI * (200 + t * 800) * t);
                    }
                }
                
                startSound = buffer;
            } catch (e) {
                console.log("Errore creazione suono inizio:", e);
            }
        }
        
        function playSound(soundBuffer, volume = 0.7) {
            if (!audioInizializzato || !soundBuffer) return;
            
            try {
                const source = audioContext.createBufferSource();
                source.buffer = soundBuffer;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.value = volume;
                
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                source.start();
                
                const durata = soundBuffer.duration;
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + durata);
            } catch (e) {
                console.log("Errore riproduzione suono:", e);
            }
        }
        
        function playWowSound() {
            playSound(wowSound, 0.8);
        }
        
        function playAhiSound() {
            playSound(ahiSound, 0.6);
        }
        
        function playSuccessSound() {
            playSound(successSound, 0.5);
        }
        
        function playClickSound() {
            playSound(clickSound, 0.3);
        }
        
        function playStartSound() {
            playSound(startSound, 0.7);
        }

        // FUNZIONI PER I DISPLAY
        function aggiornaDisplayPunteggio() {
            const punteggioDisplay = document.getElementById('punteggio-display');
            
            punteggioDisplay.style.opacity = '0.7';
            punteggioDisplay.style.transform = 'scale(1.1) skew(-1deg)';
            
            setTimeout(() => {
                punteggioDisplay.textContent = punteggio;
                punteggioDisplay.style.opacity = '1';
                punteggioDisplay.style.transform = 'scale(1) skew(-1deg)';
                
                if (punteggio >= 150) {
                    punteggioDisplay.className = 'display-7segmenti giallo';
                } else if (punteggio >= 100) {
                    punteggioDisplay.className = 'display-7segmenti verde';
                } else {
                    punteggioDisplay.className = 'display-7segmenti giallo';
                }
            }, 150);
        }
        
        function aggiornaDisplayTempo() {
            const tempoDisplay = document.getElementById('tempo-display');
            const minuti = Math.floor(tempoRimanente / 60);
            const secondi = tempoRimanente % 60;
            const tempoFormattato = `${minuti.toString().padStart(2, '0')}:${secondi.toString().padStart(2, '0')}`;
            
            tempoDisplay.style.opacity = '0.7';
            tempoDisplay.style.transform = 'scale(1.05) skew(-1deg)';
            
            setTimeout(() => {
                tempoDisplay.textContent = tempoFormattato;
                tempoDisplay.style.opacity = '1';
                tempoDisplay.style.transform = 'scale(1) skew(-1deg)';
                
                if (tempoRimanente <= 60) {
                    tempoDisplay.style.color = '#ff0000';
                    tempoDisplay.style.textShadow = '0 0 8px rgba(255, 0, 0, 0.8), 0 0 15px rgba(255, 0, 0, 0.4)';
                    
                    if (tempoRimanente <= 10) {
                        tempoDisplay.style.animation = tempoRimanente % 2 === 0 ? 'none' : 'pulse 0.5s infinite';
                    }
                } else if (tempoRimanente <= 180) {
                    tempoDisplay.style.color = '#ff9900';
                    tempoDisplay.style.textShadow = '0 0 8px rgba(255, 153, 0, 0.8), 0 0 15px rgba(255, 153, 0, 0.4)';
                } else {
                    tempoDisplay.style.color = '#00ff00';
                    tempoDisplay.style.textShadow = '0 0 8px rgba(0, 255, 0, 0.8), 0 0 15px rgba(0, 255, 0, 0.4)';
                }
            }, 150);
        }
        
        function aggiornaViteUI() {
            const viteContainer = document.getElementById('vite-container');
            viteContainer.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const vitaDiv = document.createElement('div');
                vitaDiv.className = `vita ${i < vite ? '' : 'persa'}`;
                viteContainer.appendChild(vitaDiv);
            }
        }
        
        function avviaTimer() {
            if (timerAttivo || gameOver) return;
            
            timerAttivo = true;
            aggiornaDisplayTempo();
            
            timerInterval = setInterval(() => {
                tempoRimanente--;
                aggiornaDisplayTempo();
                
                if (tempoRimanente <= 0) {
                    fermaTimer();
                    tempoRimanente = 0;
                    gameOver = true;
                    mostraMessaggio(`TEMPO SCADUTO! Punteggio finale: ${punteggio}. Clicca "Nuova" per ricominciare`, "game-over");
                    document.getElementById("bottone-verifica").disabled = true;
                    document.getElementById("bottone-aiuto").disabled = true;
                    aggiornaUI();
                }
            }, 1000);
        }
        
        function fermaTimer() {
            clearInterval(timerInterval);
            timerAttivo = false;
        }
        
        function resetTimer() {
            fermaTimer();
            tempoRimanente = TEMPO_TOTALE;
            aggiornaDisplayTempo();
            if (giocoIniziato) {
                avviaTimer();
            }
        }

        // FUNZIONI DI GIOCO MODIFICATE
        function inizializzaGioco() {
            punteggio = 0;
            vite = 3;
            gameOver = false;
            haSbagliatoQuestaDomanda = false;
            operazioniCorretteConsecutive = 0;
            aiutiUtilizzatiDomandaCorrente = 0;
            tipoGioco = 'ordinamenti';
            verificaEseguita = false;
            tempoRimanente = TEMPO_TOTALE;
            giocoIniziato = false;
            opzioneSelezionata = null;
            rispostaAperta = "";
            
            // Inizializza audio
            if (!audioInizializzato) {
                inizializzaAudio();
            }
            
            // Nascondi area di gioco, mostra messaggio di avvio
            document.getElementById('area-domanda').style.display = 'none';
            document.getElementById('controlli-gioco').style.display = 'none';
            document.getElementById('tastiera-container').style.display = 'none';
            document.getElementById('messaggio-avvio').style.display = 'flex';
            
            aggiornaViteUI();
            aggiornaDisplayPunteggio();
            aggiornaDisplayTempo();
            
            // Aggiorna le domande disponibili
            aggiornaDomandeDisponibili();
            
            document.getElementById("bottone-verifica").disabled = false;
            document.getElementById("bottone-aiuto").disabled = false;
            
            aggiornaUI();
        }

        function iniziaGioco() {
            if (!giocoIniziato) {
                giocoIniziato = true;
                
                // Riproduci suono di inizio
                playStartSound();
                
                // Nascondi messaggio di avvio
                document.getElementById('messaggio-avvio').style.display = 'none';
                
                // Mostra area di gioco
                document.getElementById('area-domanda').style.display = 'flex';
                document.getElementById('controlli-gioco').style.display = 'flex';
                
                // Avvia il timer
                resetTimer();
                
                // Prepara la prima domanda
                nuovaDomanda();
            }
        }

        function cambiaTipoDomanda(nuovoTipo) {
            if (gameOver || !giocoIniziato) return;
            
            tipoGioco = nuovoTipo;
            verificaEseguita = false;
            haSbagliatoQuestaDomanda = false;
            aiutiUtilizzatiDomandaCorrente = 0;
            
            document.getElementById('tipo-ordinamenti').classList.remove('attiva');
            document.getElementById('tipo-problemi').classList.remove('attiva');
            document.getElementById('tipo-confronti').classList.remove('attiva');
            document.getElementById('tipo-frazioni').classList.remove('attiva');
            
            if (nuovoTipo === 'ordinamenti') {
                document.getElementById('tipo-ordinamenti').classList.add('attiva');
            } else if (nuovoTipo === 'problemi') {
                document.getElementById('tipo-problemi').classList.add('attiva');
            } else if (nuovoTipo === 'confronti') {
                document.getElementById('tipo-confronti').classList.add('attiva');
            } else {
                document.getElementById('tipo-frazioni').classList.add('attiva');
            }
            
            aggiornaDomandeDisponibili();
            nuovaDomanda();
        }

        function aggiornaDomandeDisponibili() {
            if (tipoGioco === 'ordinamenti') {
                domandeDisponibili = [...domande.ordinamenti];
            } else if (tipoGioco === 'problemi') {
                domandeDisponibili = [...domande.problemi];
            } else if (tipoGioco === 'confronti') {
                domandeDisponibili = [...domande.confronti];
            } else {
                domandeDisponibili = [...domande.frazioni];
            }
        }

        function nuovaDomanda() {
            if (gameOver) {
                inizializzaGioco();
                return;
            }
            
            if (domandeDisponibili.length === 0) {
                aggiornaDomandeDisponibili();
            }
            
            verificaEseguita = false;
            haSbagliatoQuestaDomanda = false;
            aiutiUtilizzatiDomandaCorrente = 0;
            opzioneSelezionata = null;
            rispostaAperta = "";
            nascondiMessaggio();
            
            // Seleziona una domanda casuale
            const indiceCasuale = Math.floor(Math.random() * domandeDisponibili.length);
            domandaCorrente = domandeDisponibili[indiceCasuale];
            
            // Rimuovi la domanda da quelle disponibili per evitare ripetizioni immediate
            domandeDisponibili.splice(indiceCasuale, 1);
            
            // Mostra la domanda
            mostraDomanda(domandaCorrente);
            
            // Aggiorna la tastiera in base al tipo di domanda
            aggiornaTastiera(domandaCorrente.tipo);
            
            document.getElementById("bottone-verifica").disabled = false;
            
            aggiornaUI();
        }

        function mostraDomanda(domanda) {
            const areaDomanda = document.getElementById("area-domanda");
            areaDomanda.innerHTML = "";
            
            // Crea il testo della domanda
            const testoDomanda = document.createElement("div");
            testoDomanda.className = "testo-domanda";
            testoDomanda.textContent = domanda.domanda;
            areaDomanda.appendChild(testoDomanda);
            
            // Crea il contenuto in base al tipo di domanda
            if (domanda.tipo === "scelta_multipla") {
                creaDomandaSceltaMultipla(domanda);
            } else if (domanda.tipo === "vero_falso") {
                creaDomandaVeroFalso(domanda);
            } else if (domanda.tipo === "risposta_aperta") {
                creaDomandaRispostaAperta(domanda);
            }
        }

        function creaDomandaSceltaMultipla(domanda) {
            const opzioniContainer = document.createElement("div");
            opzioniContainer.className = "opzioni-container";
            
            // Crea i bottoni per ogni opzione
            domanda.opzioni.forEach((opzione, index) => {
                const opzioneBtn = document.createElement("button");
                opzioneBtn.className = "opzione-btn";
                opzioneBtn.textContent = `${String.fromCharCode(65 + index)}) ${opzione}`;
                opzioneBtn.dataset.indice = index;
                
                opzioneBtn.onclick = () => {
                    playClickSound();
                    // Rimuovi la selezione precedente
                    document.querySelectorAll('.opzione-btn.selezionata').forEach(btn => {
                        btn.classList.remove('selezionata');
                    });
                    
                    // Aggiungi la selezione corrente
                    opzioneBtn.classList.add('selezionata');
                    opzioneSelezionata = index;
                };
                
                opzioniContainer.appendChild(opzioneBtn);
            });
            
            document.getElementById("area-domanda").appendChild(opzioniContainer);
        }

        function creaDomandaVeroFalso(domanda) {
            const opzioniContainer = document.createElement("div");
            opzioniContainer.className = "opzioni-container";
            opzioniContainer.style.gridTemplateColumns = "1fr 1fr";
            
            // Bottone VERO
            const veroBtn = document.createElement("button");
            veroBtn.className = "opzione-btn";
            veroBtn.textContent = "VERO";
            veroBtn.dataset.valore = "true";
            
            veroBtn.onclick = () => {
                playClickSound();
                document.querySelectorAll('.opzione-btn.selezionata').forEach(btn => {
                    btn.classList.remove('selezionata');
                });
                veroBtn.classList.add('selezionata');
                opzioneSelezionata = true;
            };
            
            // Bottone FALSO
            const falsoBtn = document.createElement("button");
            falsoBtn.className = "opzione-btn";
            falsoBtn.textContent = "FALSO";
            falsoBtn.dataset.valore = "false";
            
            falsoBtn.onclick = () => {
                playClickSound();
                document.querySelectorAll('.opzione-btn.selezionata').forEach(btn => {
                    btn.classList.remove('selezionata');
                });
                falsoBtn.classList.add('selezionata');
                opzioneSelezionata = false;
            };
            
            opzioniContainer.appendChild(veroBtn);
            opzioniContainer.appendChild(falsoBtn);
            document.getElementById("area-domanda").appendChild(opzioniContainer);
        }

        function creaDomandaRispostaAperta(domanda) {
            const rispostaContainer = document.createElement("div");
            rispostaContainer.className = "risposta-aperta-container";
            
            const inputContainer = document.createElement("div");
            inputContainer.className = "risposta-input-container";
            
            // Per le risposte aperte di ordinamento
            if (domanda.domanda.includes("ordine") || domanda.domanda.includes("Scrivi")) {
                // Crea una casella di testo grande per le sequenze
                const casella = document.createElement("input");
                casella.className = "casella-risposta";
                casella.type = "text";
                casella.placeholder = "Es: 1/3, 0.5, 2/3, 0.8";
                casella.style.width = "300px";
                casella.style.fontSize = "1.2rem";
                casella.style.height = "50px";
                
                casella.addEventListener('input', (e) => {
                    rispostaAperta = e.target.value;
                });
                
                casella.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        verificaRisposta();
                    }
                });
                
                inputContainer.appendChild(casella);
                
                // Aggiungi suggerimento
                const suggerimento = document.createElement("p");
                suggerimento.textContent = "Scrivi i numeri separati da virgola (es: 0.25, 1/3, 0.5)";
                suggerimento.style.color = "#ffcc00";
                suggerimento.style.fontSize = "0.9rem";
                suggerimento.style.marginTop = "10px";
                rispostaContainer.appendChild(suggerimento);
            } else {
                // Per altre risposte aperte
                const casella = document.createElement("input");
                casella.className = "casella-risposta";
                casella.type = "text";
                casella.placeholder = "Scrivi qui la risposta";
                casella.style.width = "200px";
                
                casella.addEventListener('input', (e) => {
                    rispostaAperta = e.target.value;
                });
                
                casella.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        verificaRisposta();
                    }
                });
                
                inputContainer.appendChild(casella);
            }
            
            rispostaContainer.appendChild(inputContainer);
            document.getElementById("area-domanda").appendChild(rispostaContainer);
        }

        function aggiornaTastiera(tipoDomanda) {
            const tastieraContainer = document.getElementById("tastiera-container");
            const tastieraNumerica = document.getElementById("tastiera-numerica");
            
            // Nascondi la tastiera per default
            tastieraContainer.style.display = "none";
            
            if (tipoDomanda === "vero_falso") {
                // Mostra tastiera Vero/Falso
                tastieraContainer.style.display = "block";
                creaTastieraVeroFalso();
            } else {
                // Nascondi tastiera per altri tipi
                tastieraContainer.style.display = "none";
            }
        }

        function creaTastieraVeroFalso() {
            const tastiera = document.getElementById("tastiera-numerica");
            tastiera.innerHTML = "";
            
            // Bottone VERO
            const veroBtn = document.createElement("button");
            veroBtn.className = "tasto-numero tasto-vf";
            veroBtn.textContent = "VERO";
            veroBtn.onclick = () => {
                playClickSound();
                document.querySelectorAll('.opzione-btn.selezionata').forEach(btn => {
                    btn.classList.remove('selezionata');
                });
                document.querySelector('.opzione-btn[data-valore="true"]').classList.add('selezionata');
                opzioneSelezionata = true;
            };
            tastiera.appendChild(veroBtn);
            
            // Bottone FALSO
            const falsoBtn = document.createElement("button");
            falsoBtn.className = "tasto-numero tasto-vf";
            falsoBtn.textContent = "FALSO";
            falsoBtn.onclick = () => {
                playClickSound();
                document.querySelectorAll('.opzione-btn.selezionata').forEach(btn => {
                    btn.classList.remove('selezionata');
                });
                document.querySelector('.opzione-btn[data-valore="false"]').classList.add('selezionata');
                opzioneSelezionata = false;
            };
            tastiera.appendChild(falsoBtn);
        }

        function mostraMessaggio(testo, tipo, speciale = false) {
            const messaggioDiv = document.getElementById("messaggio-verifica");
            
            if (timeoutBenvenuto) {
                clearTimeout(timeoutBenvenuto);
                timeoutBenvenuto = null;
            }
            
            messaggioDiv.textContent = testo;
            messaggioDiv.className = "messaggio-verifica mostra";
            
            messaggioDiv.classList.remove("messaggio-wow", "messaggio-ahi");
            
            if (speciale) {
                if (tipo === "wow") {
                    messaggioDiv.classList.add("messaggio-wow");
                } else if (tipo === "ahi") {
                    messaggioDiv.classList.add("messaggio-ahi");
                }
            } else if (tipo === "corretto") {
                messaggioDiv.classList.add("messaggio-corretto");
                messaggioDiv.classList.remove("messaggio-errato", "messaggio-info", "messaggio-game-over");
            } else if (tipo === "errato") {
                messaggioDiv.classList.add("messaggio-errato");
                messaggioDiv.classList.remove("messaggio-corretto", "messaggio-info", "messaggio-game-over");
            } else if (tipo === "game-over") {
                messaggioDiv.classList.add("messaggio-game-over");
                messaggioDiv.classList.remove("messaggio-corretto", "messaggio-errato", "messaggio-info");
            } else {
                messaggioDiv.classList.add("messaggio-info");
                messaggioDiv.classList.remove("messaggio-corretto", "messaggio-errato", "messaggio-game-over");
            }
        }

        function nascondiMessaggio() {
            const messaggioDiv = document.getElementById("messaggio-verifica");
            messaggioDiv.classList.remove("mostra");
            setTimeout(() => {
                messaggioDiv.textContent = "";
                messaggioDiv.className = "messaggio-verifica";
            }, 300);
        }

        function verificaRisposta() {
            if (gameOver || !giocoIniziato || !domandaCorrente) return;
            
            let rispostaUtente;
            let rispostaCorretta;
            
            // Ottieni la risposta dell'utente in base al tipo di domanda
            if (domandaCorrente.tipo === "scelta_multipla") {
                if (opzioneSelezionata === null) {
                    mostraMessaggio("Seleziona una risposta prima di verificare!", "errato");
                    return;
                }
                rispostaUtente = opzioneSelezionata;
                rispostaCorretta = domandaCorrente.risposta;
            } else if (domandaCorrente.tipo === "vero_falso") {
                if (opzioneSelezionata === null) {
                    mostraMessaggio("Seleziona VERO o FALSO prima di verificare!", "errato");
                    return;
                }
                rispostaUtente = opzioneSelezionata;
                rispostaCorretta = domandaCorrente.risposta;
            } else if (domandaCorrente.tipo === "risposta_aperta") {
                if (rispostaAperta.trim() === "") {
                    mostraMessaggio("Inserisci una risposta prima di verificare!", "errato");
                    return;
                }
                rispostaUtente = rispostaAperta.trim().toLowerCase();
                rispostaCorretta = domandaCorrente.risposta.toString().toLowerCase();
                
                // Per le risposte di ordinamento, rimuovi spazi extra e normalizza
                rispostaUtente = rispostaUtente.replace(/\s+/g, ' ').trim();
                rispostaCorretta = rispostaCorretta.replace(/\s+/g, ' ').trim();
            }
            
            // Verifica se la risposta √® corretta
            let corretta = false;
            
            if (domandaCorrente.tipo === "risposta_aperta" && domandaCorrente.domanda.includes("ordine")) {
                // Per ordinamenti, confronta le sequenze normalizzate
                const utenteNormalizzato = rispostaUtente.replace(/\s*,\s*/g, ', ').trim();
                const correttoNormalizzato = rispostaCorretta.replace(/\s*,\s*/g, ', ').trim();
                
                // Confronta ignorando eventuali spazi extra
                corretta = utenteNormalizzato === correttoNormalizzato;
                
                // Se non corrisponde esattamente, prova a confrontare come array
                if (!corretta) {
                    const arrayUtente = utenteNormalizzato.split(',').map(item => item.trim());
                    const arrayCorretto = correttoNormalizzato.split(',').map(item => item.trim());
                    
                    if (arrayUtente.length === arrayCorretto.length) {
                        corretta = arrayUtente.every((item, index) => item === arrayCorretto[index]);
                    }
                }
            } else {
                corretta = rispostaUtente == rispostaCorretta;
            }
            
            if (corretta) {
                const puntiGuadagnati = 2 - (aiutiUtilizzatiDomandaCorrente * 2);
                const puntiFinali = Math.max(0, puntiGuadagnati);
                
                punteggio += puntiFinali;
                operazioniCorretteConsecutive++;
                
                let messaggioPunti = `‚úì Corretto!`;
                
                if (domandaCorrente.difficolta >= 3) {
                    messaggioPunti = `WOW! ` + messaggioPunti + ` Ordinamento difficile completato! `;
                    playWowSound();
                } else {
                    playSuccessSound();
                }
                
                if (puntiFinali > 0) {
                    messaggioPunti += ` +${puntiFinali} punti`;
                } else {
                    messaggioPunti += ` 0 punti (troppi aiuti!)`;
                }
                
                if (operazioniCorretteConsecutive >= 5 && vite < 3) {
                    vite++;
                    operazioniCorretteConsecutive = 0;
                    messaggioPunti += ` üéâ 5 risposte consecutive! Vita recuperata!`;
                }
                
                if (domandaCorrente.difficolta >= 3) {
                    mostraMessaggio(messaggioPunti, "wow", true);
                } else {
                    mostraMessaggio(messaggioPunti, "corretto");
                }
                
                setTimeout(nuovaDomanda, 3000);
                verificaEseguita = true;
            } else {
                operazioniCorretteConsecutive = 0;
                
                if (!haSbagliatoQuestaDomanda) {
                    vite--;
                    haSbagliatoQuestaDomanda = true;
                    verificaEseguita = false;
                    
                    if (vite <= 0) {
                        gameOver = true;
                        fermaTimer();
                        
                        playAhiSound();
                        
                        mostraMessaggio(`AHI! GAME OVER! Punteggio finale: ${punteggio}. Clicca "Nuova" per ricominciare`, "ahi", true);
                        document.getElementById("bottone-verifica").disabled = true;
                        document.getElementById("bottone-aiuto").disabled = true;
                    } else {
                        if (domandaCorrente.difficolta >= 2) {
                            playAhiSound();
                            mostraMessaggio(`AHI! Hai perso una vita! Vite rimaste: ${vite}`, "ahi", true);
                        } else {
                            mostraMessaggio(`Ahi! Hai perso una vita! Vite rimaste: ${vite}`, "errato");
                        }
                    }
                } else {
                    mostraMessaggio(`La risposta non √® corretta. Riprova!`, "errato");
                }
            }
            
            aggiornaUI();
        }

        function mostraAiuto() {
            if (gameOver || !giocoIniziato || !domandaCorrente) {
                mostraMessaggio("Devi prima iniziare a giocare!", "errato");
                return;
            }
            
            if (punteggio <= 0 && aiutiUtilizzatiDomandaCorrente >= 1) {
                mostraMessaggio("Attenzione! Potresti finire con 0 punti per questa domanda!", "errato");
                return;
            }
            
            aiutiUtilizzatiDomandaCorrente++;
            
            const puntiDaSottrarre = 2;
            let messaggioAiuto = "";
            
            if (domandaCorrente.tipo === "scelta_multipla") {
                // Per scelta multipla, suggerisce eliminando 2 opzioni sbagliate
                const opzioniCorrette = [domandaCorrente.risposta];
                const opzioniSbagliate = [0, 1, 2, 3].filter(i => i !== domandaCorrente.risposta);
                
                // Seleziona 2 opzioni sbagliate casuali da eliminare
                const eliminate = [];
                while (eliminate.length < 2 && opzioniSbagliate.length > 0) {
                    const indiceCasuale = Math.floor(Math.random() * opzioniSbagliate.length);
                    eliminate.push(opzioniSbagliate.splice(indiceCasuale, 1)[0]);
                }
                
                messaggioAiuto = `Aiuto: le opzioni ${eliminate.map(i => String.fromCharCode(65 + i)).join(' e ')} sono sbagliate.`;
                
            } else if (domandaCorrente.tipo === "vero_falso") {
                // Per vero/falso, d√† un suggerimento
                messaggioAiuto = domandaCorrente.risposta ? 
                    "Aiuto: pensa bene se l'affermazione √® vera..." : 
                    "Aiuto: pensa bene se l'affermazione √® falsa...";
            } else if (domandaCorrente.tipo === "risposta_aperta") {
                // Per risposta aperta, d√† un suggerimento
                if (domandaCorrente.domanda.includes("ordine") || domandaCorrente.domanda.includes("Scrivi")) {
                    messaggioAiuto = "Aiuto: converte tutte le frazioni in decimali per confrontarle pi√π facilmente.";
                } else {
                    messaggioAiuto = "Aiuto: leggi bene la domanda e fai attenzione a cosa chiede.";
                }
            }
            
            messaggioAiuto += ` (-${puntiDaSottrarre} punti, totale aiuti: ${aiutiUtilizzatiDomandaCorrente})`;
            
            mostraMessaggio(messaggioAiuto, "info");
            playClickSound();
            aggiornaUI();
        }

        function aggiornaUI() {
            aggiornaDisplayPunteggio();
            aggiornaViteUI();
            document.getElementById("contatore-consecutive").textContent = operazioniCorretteConsecutive;
            document.getElementById("contatore-aiuti").textContent = aiutiUtilizzatiDomandaCorrente;
            
            const indicatoreConsecutive = document.getElementById("risposte-consecutive");
            if (operazioniCorretteConsecutive > 0) {
                indicatoreConsecutive.style.display = "flex";
            } else {
                indicatoreConsecutive.style.display = "none";
            }
            
            const indicatoreAiuti = document.getElementById("aiuti-utilizzati");
            if (aiutiUtilizzatiDomandaCorrente > 0) {
                indicatoreAiuti.style.display = "flex";
            } else {
                indicatoreAiuti.style.display = "none";
            }
        }

        function mostraIstruzioni() {
            document.getElementById('modal-overlay').style.display = 'flex';
            playClickSound();
        }
        
        function nascondiIstruzioni() {
            document.getElementById('modal-overlay').style.display = 'none';
            playClickSound();
        }

        // SETUP INIZIALE
        document.addEventListener('DOMContentLoaded', function() {
            // Setup event listeners per i tipi di domanda
            document.getElementById('tipo-ordinamenti').addEventListener('click', () => {
                playClickSound();
                cambiaTipoDomanda('ordinamenti');
            });
            
            document.getElementById('tipo-problemi').addEventListener('click', () => {
                playClickSound();
                cambiaTipoDomanda('problemi');
            });
            
            document.getElementById('tipo-confronti').addEventListener('click', () => {
                playClickSound();
                cambiaTipoDomanda('confronti');
            });
            
            document.getElementById('tipo-frazioni').addEventListener('click', () => {
                playClickSound();
                cambiaTipoDomanda('frazioni');
            });
            
            // Setup event listeners per i controlli
            document.getElementById('bottone-aiuto').addEventListener('click', mostraAiuto);
            document.getElementById('bottone-verifica').addEventListener('click', verificaRisposta);
            document.getElementById('bottone-nuova').addEventListener('click', () => {
                playClickSound();
                nuovaDomanda();
            });
            
            // Setup event listeners per le istruzioni
            document.getElementById('istruzioni-btn').addEventListener('click', mostraIstruzioni);
            document.getElementById('close-modal').addEventListener('click', nascondiIstruzioni);
            
            document.getElementById('modal-overlay').addEventListener('click', function(event) {
                if (event.target === this) {
                    nascondiIstruzioni();
                }
            });
            
            // Aggiungi click al messaggio di avvio
            document.getElementById('messaggio-avvio').addEventListener('click', iniziaGioco);
            
            // Inizializza audio
            inizializzaAudio();
            
            // Inizializza il gioco
            setTimeout(inizializzaGioco, 100);
        });

        // Gestione resize
        window.addEventListener('resize', function() {
            if (domandaCorrente && domandaCorrente.tipo === "vero_falso") {
                creaTastieraVeroFalso();
            }
        });
    </script>
</body>
</html>